# React Heroku Guide!

Previous cheat-sheets:
 1. [Heroku CheatSheet (Python)](https://gist.git.generalassemb.ly/katie/2b04e662ffc32713aad1b07747aceed9)
 2. [Node/Express Heroku Guide](https://gist.git.generalassemb.ly/katie/63ea03930d1f01ec748fd23573de8615)


## Recommended folder structure

Set up the server first (any server, Express or Python Flask or others!), then use `create react-app` to set up a React app in a new `client` folder.

```
yarn create react-app client
```

OR (if you want to use TypeScript)

```
yarn create react-app client --template typescript
```

Here's roughly what the folder structure will look like (Node server version):

```
my-project-repo
  - package.json (for the server!)
  - server.js
  - ... any other server stuff
  - client (this is generated by create react-app)
     - build (not included in git!)
     - public
     - src
        - App.js
        - ... all your other React code!
     - .gitignore
     - package.json (for the react client!)
```

**Notice that there are _two_ `package.json` files!** One is for the server, one is for the client code (React).

## Local dev

Goals for local development:
 - Both the React app and server API should be available on the same server and port (`localhost:3000`) so `axios.get('/api/test')` can work without us needing to write `axios.get('http://localhost:3001/api/test')`!
 - Automatic reloading for the React app when you change files (need to use `yarn start` in the client for this!)
 - Automatic reloading for the server code (using nodemon like before!)

You will need _two_ terminals because we want to run our server and the React development server at the same time.

Steps to set up:
 - Make sure your server is set up to use port 3001 (or any port except 3000 because that's what React will use)
 - Add `"proxy": "http://localhost:3001"` to the `client` `package.json` file (adjust the port if needed).
 - Run `yarn start` in the `client` folder (run the React app)
 - Run the server in a separate terminal

### What is this 'proxy' doing?

The React development server (the one you started with `yarn start` in the client folder) can detect the difference between
a normal browser fetch (e.g. fetching HTML/JS/CSS files) and an API request - called an AJAX reqest.

If it detects that it's an normal browser fetch, it won't use the proxy URL, but if it's an API
request (sent by axios/fetch) then it will send that request to the proxy instead.
It will forward the request to your server which is running on `localhost:3001`.

This means that going to `http://localhost:3000/api/something` in the URL bar of the browser _won't work_.
But doing `axios.get('/api/something')` or `axios.get('http://localshot:3000/api/something')` _will work_ from within your app.

## Deploying to Heroku

On Heroku, we don't need automatic reloading of files when we change them so we don't need to run two separate servers, we can make our main server (the API one) serve both. 

In `server.js` add this line so that it will serve HTML/JS/CSS files from the `client/build` folder:
```
app.use(express.static('./client/build'))
```

And now we just need to tell Heroku to run `yarn build` for us whenever we deploy a new version:

Add this to the _server_ `package.json`

```
  "scripts": {
    "start": "node server.js",
    "heroku-postbuild": "cd client && yarn && yarn build"
  },
```
NOTE: 
Once you have created the react-app typescript etc. 
Need to delete the package-lock.json files automatically created in client folder and server (root directory etc.). Heroku can only install from one dependency. In this case use yarn to install